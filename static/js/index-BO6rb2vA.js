import{g as Je,a as ce,b as Oe,d as Le,c as Ue,e as ze,s as ue}from"./database-LwlVviPM.js";import de from"./codeMirror-LssiHNZV.js";import{_ as Ee}from"./customRedisClient.vue_vue_type_script_setup_true_lang-c_lkd6Yl.js";import{d as Ae,r as _,u as R,i as h,M as l,v as s,A as f,g as T,C as c,y as m,j as O,q as A,F as H,x as J,aU as He,aV as Me,aW as We,aX as Pe,aJ as M,aI as N,ae as je,af as Fe,h as W,_ as qe}from"./index-CpafBiW4.js";import"./index-glDPGLTR.js";import"./index-BkB1o4-I.js";const fe=K=>(je("data-v-fe3ce9e4"),K=K(),Fe(),K),Xe={class:"flex items-center"},Ge=fe(()=>O("div",{class:"mr-3"},"排列方向:",-1)),Qe=fe(()=>O("div",{class:"mx-3"},"边框:",-1)),Ye={key:0},Ze={key:1},et={class:"button-margin-bottom"},tt=Ae({name:"Redis",__name:"index",setup(K){ze();const pe={value:"key"},$=a=>window.innerWidth<992?Math.floor(a/2):a,C=_(!0),V=_("horizontal"),p=_(),P=_({}),j=_([]),v=_();Je().then(a=>{p.value=a.data,v.value=p.value.slelct_database.toString(),j.value=Array.from({length:Number(p.value.databases)},(e,n)=>String(n));for(let e=0;e<16;e++)if(p.value[`db${e}`]){const n={};p.value[`db${e}`].split(",").forEach(o=>{const[i,r]=o.split("=");n[i.trim()]=r.trim()}),P.value[`db${e}`]=n}});const _e=()=>{U.value=!0,b=[]},g=_({host:"",port:6379,database:0,username:"",password:""}),L=_(),me=()=>{M({width:window.innerWidth<992?"90%":"50%",title:"自定义redis地址",contentRenderer:()=>W(Ee,{ref:L}),props:{data:{...g.value}},sureBtnLoading:!0,beforeSure:async(a,{options:e,index:n,closeLoading:o})=>{await L.value.getRef().validate(r=>{if(r){const d=L.value.getData();F(!0,d.host,d.port,d.database,d.username,d.password).then(u=>{u.success?a():o()}).catch(()=>o())}else o()})},draggable:!0})},F=async(a,e,n,o,i,r)=>{try{const d=await Ue(e,n,o,i,r);if(a)if(d.success){N("连接成功~ Ciallo～(∠・ω< )⌒☆'",{customClass:"el",type:"success"}),g.value={host:e,port:n,database:o,username:i,password:r};const u=JSON.parse(localStorage.getItem("redisHistory")||"[]"),w=`${e}:${n}:${o}:${i||""}:${r||""}`,D=u.indexOf(w);D!==-1&&u.splice(D,1),u.unshift(w),u.length>10&&(u.length=10),q.value=u,localStorage.setItem("redisHistory",JSON.stringify(u)),v.value=g.value.database.toString()}else N(d.message,{type:"error",customClass:"el"});return d}catch(d){return{success:!1,message:d.message}}},q=_(JSON.parse(localStorage.getItem("redisHistory")||"[]")),ve=a=>{const[e,n,o,i,r]=a.split(":");v.value=o,g.value={host:e,port:Number(n),database:Number(o),username:i,password:r},F(!1,g.value.host,g.value.port,g.value.database,g.value.username,g.value.password).then(d=>{d.success&&z()})},U=_(!0),y=_("2");let b=[];const z=()=>{U.value=!1,y.value==="2"&&ce(":",v.value).then(a=>{b=a.data,k.value.setData(b)})},ye=(a,e)=>{var n;ce(((n=a.data)==null?void 0:n.key)||"",v.value,!0).then(o=>e(o.data))},X=_(["2"]),B=_(""),x=_(),k=_(),S=_(),G=(a,e)=>{e.isLeaf&&Oe(a.key,v.value).then(n=>{if(!n.success){N(n.message,{type:"error",customClass:"el"});return}try{n.data.value=JSON.stringify(JSON.parse(n.data.value),null,2)}catch{}M({width:window.innerWidth<992?"90%":"50%",title:"编辑",contentRenderer:()=>W(de,{ref:S}),props:{data:{key:a.key,value:n.data.value,expire:n.data.expire,db:v.value}},closeCallBack:({options:o,args:i})=>{if((i==null?void 0:i.command)==="sure"){const r=S.value.getData();try{r.value=JSON.stringify(JSON.parse(r.value))}catch{}r.expire<-1?r.expire=-1:r.expire===n.data.expire&&(r.expire=-2);const d=r.key!==a.key;ue(a.key,r.value,v.value,r.expire,d?r.key:void 0).then(u=>{N("保存成功~ Ciallo～(∠・ω< )⌒☆'",{customClass:"el",type:"success"}),d&&(y.value==="2"?(ae(a.key),le(u.data.key),k.value.setData(b)):(Z(a.key),Y(u.data.key)))})}},beforeSure:(o,{options:i,index:r})=>{S.value.checkCode()&&o()},draggable:!0})})},Q=(a=!1)=>{a===!0?(B.value="",y.value==="2"?(k.value.filter(""),k.value.setExpandedKeys([])):x.value.filter("")):(y.value==="2"?k:x).value.filter(B.value)},Y=a=>{let e=null;const n=a.split(":");let o=0;for(const i of n){const r=e?`${e}:${i}`:i;x.value.getNode(r)||x.value.append({label:i,key:r,children:[],isLeaf:o===n.length-1},e),e?e+=`:${i}`:e=i,o++}},Z=a=>{let e=a;for(const n of a.split(":").reverse()){const o=x.value.getNode(e);o!=null&&o.isLeaf&&x.value.remove(o),e.includes(":")&&(e=e.replace(new RegExp(`:${n}$`),""))}},he=()=>{const a=y.value==="2"?k:x,e=Array.from(new Set(a.value.getCheckedNodes().filter(o=>{var i;return(i=a.value.getNode(o.key))==null?void 0:i.isLeaf}).map(o=>o.key.replace(/:[^:]*$/,"")))),n=e.length===1?e[0]+":":"";M({width:window.innerWidth<992?"90%":"50%",title:"添加",contentRenderer:()=>W(de,{ref:S}),props:{data:{key:n,value:"",expire:-1,db:v.value}},closeCallBack:({options:o,args:i})=>{if((i==null?void 0:i.command)==="sure"){const r=S.value.getData();try{r.value=JSON.stringify(JSON.parse(r.value))}catch{}r.expire<-1&&(r.expire=-1),ue(r.key,r.value,v.value,r.expire).then(d=>{N("添加成功~ Ciallo～(∠・ω< )⌒☆'",{customClass:"el",type:"success"}),y.value==="2"?(le(d.data.key),k.value.setData(b)):Y(d.data.key)})}},beforeSure:(o,{options:i,index:r})=>{S.value.checkCode()&&o()},draggable:!0})},I=_([]),ee=_("确定要删除吗?"),ke=()=>{const a=y.value==="2"?k:x;I.value=a.value.getCheckedNodes().filter(e=>{var n;return(n=a.value.getNode(e.key))==null?void 0:n.isLeaf}).map(e=>e.key),ee.value=`已选择${I.value.length}个key,确定要删除所选吗?`},ge=()=>{if(!I.value.length){N("请选择要删除的key~",{customClass:"el",type:"warning"});return}Le(I.value,v.value).then(a=>{if(a.success)if(N("删除成功~ Ciallo～(∠・ω< )⌒☆'",{customClass:"el",type:"success"}),y.value==="2"){for(const e of a.data.successKeys)ae(e);k.value.setData(b)}else for(const e of a.data.successKeys)Z(e)})},te=(a,e)=>e.key.includes(a),le=a=>{const e=a.split(":");let n=b;for(let o=0;o<e.length;o++){const i=e.slice(0,o+1).join(":");let r=n.find(d=>d.key===i);r||(r={label:e[o],key:i,children:[]},n.push(r)),n=r.children}},ae=a=>{const e=oe(b,a);e&&be(b,e)},oe=(a,e)=>{for(const n in a){const o=a[n];if(o.key===e)return[n];if(o.children&&o.children.length>0){const i=oe(o.children,e);if(i)return[n,...i]}}return null},be=(a,e)=>{let n=a;for(let o=0;o<e.length-1;o++)n=n[e[o]].children;n.splice(e[e.length-1],1),se(a,e.slice(0,-1))},se=(a,e)=>{if(e.length===0)return;let n=a;for(let r=0;r<e.length-1;r++)n=n[e[r]].children;const o=e[e.length-1];n[o].children.length===0&&(n.splice(o,1),se(a,e.slice(0,-1)))};return(a,e)=>{const n=f("el-radio-button"),o=f("el-radio-group"),i=f("el-switch"),r=f("el-button"),d=f("el-tooltip"),u=f("el-descriptions-item"),w=f("el-descriptions"),D=f("el-collapse-item"),xe=f("el-option"),we=f("el-select"),Ce=f("el-input"),ne=f("re-col"),re=f("el-popconfirm"),Ve=f("el-row"),Ne=f("el-icon"),Se=f("el-dropdown-item"),Re=f("el-dropdown-menu"),$e=f("el-dropdown"),De=f("el-text"),Te=f("el-divider"),ie=f("el-radio"),Ke=f("el-space"),Be=f("el-collapse"),Ie=f("el-card");return h(),R(Ie,null,{default:l(()=>[s(Be,{modelValue:X.value,"onUpdate:modelValue":e[6]||(e[6]=t=>X.value=t),class:"text-2xl"},{default:l(()=>[s(D,{title:"信息",name:"1"},{default:l(()=>[s(w,{border:C.value,direction:V.value,title:"Server",column:$(5)},{extra:l(()=>[s(d,{effect:"light",content:"Top Left prompts info",placement:"left",trigger:"click"},{content:l(()=>[O("div",Xe,[Ge,s(o,{modelValue:V.value,"onUpdate:modelValue":e[0]||(e[0]=t=>V.value=t)},{default:l(()=>[s(n,{value:"vertical",size:"small"},{default:l(()=>[c(" 垂直 ")]),_:1}),s(n,{value:"horizontal",size:"small"},{default:l(()=>[c(" 水平 ")]),_:1})]),_:1},8,["modelValue"]),Qe,s(i,{modelValue:C.value,"onUpdate:modelValue":e[1]||(e[1]=t=>C.value=t)},null,8,["modelValue"])])]),default:l(()=>[s(r,{size:"small",type:"primary",class:"mr-6"},{default:l(()=>[c(" 设置 ")]),_:1})]),_:1})]),default:l(()=>[s(u,{label:"Redis 版本"},{default:l(()=>{var t;return[c(m((t=p.value)==null?void 0:t.redis_version),1)]}),_:1}),s(u,{label:"os"},{default:l(()=>{var t;return[c(m((t=p.value)==null?void 0:t.os),1)]}),_:1}),s(u,{label:"监听端口"},{default:l(()=>{var t;return[c(m((t=p.value)==null?void 0:t.tcp_port),1)]}),_:1}),s(u,{label:"已运行时间"},{default:l(()=>{var t;return[c(m((t=p.value)==null?void 0:t.uptime_formatted),1)]}),_:1})]),_:1},8,["border","direction","column"]),s(w,{border:C.value,direction:V.value,title:"Memory",column:$(5),class:"mt-4"},{default:l(()=>[s(u,{label:"当前内存占用"},{default:l(()=>{var t;return[c(m((t=p.value)==null?void 0:t.used_memory_human),1)]}),_:1}),s(u,{label:"最大内存占用"},{default:l(()=>{var t;return[c(m((t=p.value)==null?void 0:t.used_memory_peak_human),1)]}),_:1})]),_:1},8,["border","direction","column"]),s(w,{border:C.value,direction:V.value,title:"Stats",column:$(6),class:"mt-4"},{default:l(()=>[s(u,{label:"接受连接总数"},{default:l(()=>{var t;return[c(m((t=p.value)==null?void 0:t.total_connections_received),1)]}),_:1}),s(u,{label:"处理命令总数"},{default:l(()=>{var t;return[c(m((t=p.value)==null?void 0:t.total_commands_processed),1)]}),_:1}),s(u,{label:"当前每秒处理命令数"},{default:l(()=>{var t;return[c(m((t=p.value)==null?void 0:t.instantaneous_ops_per_sec),1)]}),_:1}),s(u,{label:"查找key成功次数"},{default:l(()=>{var t;return[c(m((t=p.value)==null?void 0:t.keyspace_hits),1)]}),_:1}),s(u,{label:"查找key失败次数"},{default:l(()=>{var t;return[c(m((t=p.value)==null?void 0:t.keyspace_misses),1)]}),_:1})]),_:1},8,["border","direction","column"]),s(w,{border:C.value,direction:V.value,title:"Cpu",column:$(5),class:"mt-4"},{default:l(()=>[s(u,{label:"系统cpu使用率"},{default:l(()=>{var t;return[c(m((t=p.value)==null?void 0:t.used_cpu_sys),1)]}),_:1}),s(u,{label:"用户cpu使用率"},{default:l(()=>{var t;return[c(m((t=p.value)==null?void 0:t.used_cpu_user),1)]}),_:1})]),_:1},8,["border","direction","column"]),(h(!0),T(H,null,A(P.value,(t,E)=>(h(),R(w,{key:E,border:C.value,direction:V.value,title:E,column:$(5),class:"mt-4"},{default:l(()=>[s(u,{label:"key数量"},{default:l(()=>[c(m(t.keys),1)]),_:2},1024),s(u,{label:"过期key数量"},{default:l(()=>[c(m(t.expires),1)]),_:2},1024)]),_:2},1032,["border","direction","title","column"]))),128))]),_:1}),s(D,{title:"数据",name:"2"},{default:l(()=>[U.value?(h(),T("div",Ze,[s(Ke,{direction:"vertical",alignment:"left"},{default:l(()=>[O("div",et,[s(r,{type:"success",onClick:z},{default:l(()=>[c(" 点我加载数据 ")]),_:1}),s(r,{type:"primary",class:"mr-3",onClick:me},{default:l(()=>[c(" 自定义redis地址 ")]),_:1}),s($e,{trigger:"click"},{dropdown:l(()=>[s(Re,null,{default:l(()=>[(h(!0),T(H,null,A(q.value,t=>(h(),R(Se,{key:t,onClick:E=>ve(t)},{default:l(()=>[c(m(t),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),default:l(()=>[s(r,{type:"info"},{default:l(()=>[c(" 使用历史记录加载数据 "),s(Ne,{class:"ml-1"},{default:l(()=>[s(J(Pe))]),_:1})]),_:1})]),_:1})]),s(De,{class:"mx-1",type:"warning",size:"large"},{default:l(()=>[c("请注意: 如果redis数据量过大, 可能会导致服务器卡顿, 此时建议使用懒加载模式")]),_:1}),s(Te,{"content-position":"left"},{default:l(()=>[c("数据加载方式")]),_:1}),s(o,{modelValue:y.value,"onUpdate:modelValue":e[5]||(e[5]=t=>y.value=t)},{default:l(()=>[s(ie,{value:"1"},{default:l(()=>[c("Tree 懒加载模式点击节点时获取数据")]),_:1}),s(ie,{value:"2"},{default:l(()=>[c("Tree V2 一次性加载所有数据")]),_:1})]),_:1},8,["modelValue"])]),_:1})])):(h(),T("div",Ye,[s(Ve,null,{default:l(()=>[s(ne,{span:12,xs:24,class:"mr-[10px]"},{default:l(()=>[s(we,{modelValue:v.value,"onUpdate:modelValue":e[2]||(e[2]=t=>v.value=t),class:"mr-[10px] mb-[10px]",style:{width:"100px"},onChange:z},{default:l(()=>[(h(!0),T(H,null,A(j.value,t=>(h(),R(xe,{key:t,label:`db${t}`,value:t},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),s(Ce,{modelValue:B.value,"onUpdate:modelValue":e[3]||(e[3]=t=>B.value=t),class:"mb-[10px]",style:{width:"280px"},placeholder:"请输入key"},{append:l(()=>[s(r,{icon:J(He),onClick:Q},null,8,["icon"])]),_:1},8,["modelValue"])]),_:1}),s(ne,{span:12,xs:24},{default:l(()=>[s(r,{type:"warning",onClick:e[4]||(e[4]=t=>Q(!0))},{default:l(()=>[c(" 重置 ")]),_:1}),s(r,{type:"success",onClick:he},{default:l(()=>[c("添加")]),_:1}),s(re,{title:ee.value,width:"300px",onConfirm:ge},{reference:l(()=>[s(r,{type:"danger",onClick:ke},{default:l(()=>[c(" 删除 ")]),_:1})]),_:1},8,["title"]),s(re,{title:"确定返回到数据加载页面吗?",width:"250px",onConfirm:_e},{reference:l(()=>[s(r,{type:"info"},{default:l(()=>[c("返回")]),_:1})]),_:1})]),_:1})]),_:1}),y.value==="2"?(h(),R(J(Me),{key:0,ref_key:"treeRefV2",ref:k,props:pe,"show-checkbox":"",height:650,"filter-method":te,onNodeClick:G},null,512)):(h(),R(J(We),{key:1,ref_key:"treeRef",ref:x,load:ye,lazy:"","node-key":"key","show-checkbox":"","filter-node-method":te,onNodeClick:G},null,512))]))]),_:1})]),_:1},8,["modelValue"])]),_:1})}}}),it=qe(tt,[["__scopeId","data-v-fe3ce9e4"]]);export{it as default};
