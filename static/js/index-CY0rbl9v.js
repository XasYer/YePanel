import{d as te,r as p,g as _,i as c,v as e,M as t,D as V,A as s,C as m,y as h,j as i,F as b,q as k,x as T,aB as le,V as Y,u as x,aC as ae,aD as ne,B as z,t as se,G as oe}from"./index-CpafBiW4.js";import{g as ue,a as M,b as ce}from"./Bot-DBDjahQk.js";import{_ as ie}from"./CountChart.vue_vue_type_script_setup_true_lang-DBkOOZzq.js";import{_ as re}from"./RankChart.vue_vue_type_script_setup_true_lang-DwQ9mlX3.js";import{u as de}from"./home-BHhQGy0V.js";import{g as ve}from"./home-dZ3xXtdR.js";const _e={class:"flex mb-2"},me={class:"flex mb-2"},fe={class:"flex"},pe={class:"flex justify-between"},he=i("span",{class:"text-md font-medium"},"消息统计",-1),ge={class:"flex justify-between items-start mt-3"},ye=i("p",null," 如果需要此统计, 请在stats.yaml中设置countChart中任意一项为true ",-1),xe={class:"flex justify-between"},be={class:"text-md font-medium flex-c"},ke={class:"flex justify-between items-start mt-3"},Se={key:0,class:"flex-c w-full h-[300px]"},Ce={key:1,class:"flex-c w-full h-[300px]"},Re=te({__name:"index",setup(we){const B=de(),r=p({countChart:!0,rankChart:!0,totalStats:!0}),j={style:[{label:"基础饼图",value:"Base"},{label:"南丁格尔玫瑰图",value:"Nightingale"},{label:"环形图",value:"Doughnut"}],time:(()=>{const o=[];for(let l=0;l<7;l++){const v=ae().subtract(l,"day").format("YYYY-MM-DD");o.push({label:v,value:v})}return o})()},u=p({style:"Base",time:j.time[0].value,info:"全部数据"}),d=p({sent:[],recv:[],plugin:[],time:[]}),$=[{key:"sentType",name:"发送消息类型统计",desc:"发送消息类型的次数"},{key:"pluginSent",name:"插件发送消息排行",desc:"插件使用reply()方法发送消息的次数"},{key:"userSent",name:"Bot向用户发送消息排行",desc:"Bot向用户发送消息的次数"},{key:"groupSent",name:"Bot向群发送消息排行",desc:"Bot向群发送消息的次数"},{key:"pluginUse",name:"插件调用次数排行",desc:"插件被调用的次数, 不一定会发送消息"},{key:"userRecv",name:"接收用户消息排行",desc:"来自对应用户的消息数量"},{key:"groupRecv",name:"接收群消息排行",desc:"来自对应群的消息数量"}],g=p({pluginUse:[],userSent:[],groupSent:[],pluginSent:[],userRecv:[],groupRecv:[],sentType:[]}),R=p({sent:0,recv:0,plugin:0}),F=[{key:"plugin",name:"插件调用总数"},{key:"sent",name:"发送消息总数"},{key:"recv",name:"接收消息总数"}],f=p({AllStats:{name:"全部数据",uin:"AllStats",avatar:""}});B.botInfo.length?f.value=B.botInfo.reduce((o,l)=>(o[l.uin]={name:l.nickname,uin:l.uin,avatar:l.avatar},o),{}):ve().then(o=>{o.success&&(B.setBotInfo(o.data),f.value=o.data.reduce((l,v)=>(l[v.uin]={name:v.nickname,uin:v.uin,avatar:v.avatar},l),{}))});const I=o=>{ue(o).then(l=>{l.success&&(d.value=l.data),r.value.countChart=!1}),M(u.value.time,o).then(l=>{l.success&&(g.value=l.data),r.value.rankChart=!1}),ce(o).then(l=>{l.success&&(R.value=l.data),r.value.totalStats=!1})};I();const H=()=>{r.value.rankChart=!0,M(u.value.time).then(o=>{o.success&&(g.value=o.data),r.value.rankChart=!1})},K=()=>{r.value.countChart=!0,r.value.rankChart=!0,r.value.totalStats=!0,I(u.value.info==="AllStats"?void 0:u.value.info)},y=p(0);return(o,l)=>{const v=s("el-avatar"),q=s("el-aside"),E=s("el-button"),S=s("el-text"),C=s("el-option"),A=s("el-select"),G=s("el-popover"),W=s("el-header"),J=s("el-main"),L=s("el-container"),w=s("el-card"),D=s("el-col"),O=s("el-statistic"),P=s("el-segmented"),U=s("el-result"),Q=s("el-icon"),X=s("el-tooltip"),Z=s("el-row"),N=Y("loading"),ee=Y("motion");return c(),_("div",null,[e(Z,{gutter:24},{default:t(()=>[e(D,{class:"mb-[18px]",xl:6,xs:24,md:24,sm:24,lg:12},{default:t(()=>[e(w,{class:"bar-card h-[100px]",shadow:"never"},{default:t(()=>[e(L,{class:"flex justify-between"},{default:t(()=>[e(q,{width:"60px"},{default:t(()=>{var a;return[e(v,{size:60,src:(a=f.value[u.value.info])==null?void 0:a.avatar},{default:t(()=>{var n;return[m(h(((n=f.value[u.value.info])==null?void 0:n.name)||"全部数据"),1)]}),_:1},8,["src"])]}),_:1}),e(L,null,{default:t(()=>[e(W,{height:"10px"},{default:t(()=>{var a;return[m(h(((a=f.value[u.value.info])==null?void 0:a.name)||"全部数据")+" ",1),e(G,{placement:"bottom",title:"设置",width:300,trigger:"click"},{reference:t(()=>[e(E,{icon:T(le),class:"ml-2",circle:"",size:"small"},null,8,["icon"])]),default:t(()=>[i("div",_e,[e(S,{class:"w-[80px]"},{default:t(()=>[m("数据来源")]),_:1}),e(A,{modelValue:u.value.info,"onUpdate:modelValue":l[0]||(l[0]=n=>u.value.info=n),onChange:K},{default:t(()=>[e(C,{label:"全部数据",value:"AllStats"}),(c(!0),_(b,null,k(f.value,n=>(c(),x(C,{key:n.uin,label:n.name,value:n.uin},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),i("div",me,[e(S,{class:"w-[80px]"},{default:t(()=>[m("饼图样式")]),_:1}),e(A,{modelValue:u.value.style,"onUpdate:modelValue":l[1]||(l[1]=n=>u.value.style=n)},{default:t(()=>[(c(!0),_(b,null,k(j.style,n=>(c(),x(C,{key:n.value,label:n.label,value:n.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),i("div",fe,[e(S,{class:"w-[80px]"},{default:t(()=>[m("饼图日期")]),_:1}),e(A,{modelValue:u.value.time,"onUpdate:modelValue":l[2]||(l[2]=n=>u.value.time=n),onChange:H},{default:t(()=>[(c(!0),_(b,null,k(j.time,n=>(c(),x(C,{key:n.value,label:n.label,value:n.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),_:1})]}),_:1}),e(J,null,{default:t(()=>{var a;return[m(h(((a=f.value[u.value.info])==null?void 0:a.uin)||"AllStats"),1)]}),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),(c(),_(b,null,k(F,a=>V(e(D,{key:a.key,class:"mb-[18px] text-center",xl:6,xs:8,md:8,sm:8,lg:12},{default:t(()=>[e(w,{class:"bar-card flex-c h-[100px]",shadow:"never"},{default:t(()=>[e(O,{value:R.value[a.key]||"未开启统计"},{title:t(()=>[e(S,{tag:"b"},{default:t(()=>[m(h(a.name),1)]),_:2},1024)]),_:2},1032,["value"])]),_:2},1024)]),_:2},1024),[[N,r.value.totalStats]])),64)),V((c(),x(D,{class:"mb-[18px]",xl:16,xs:24,md:24,sm:24,lg:12},{default:t(()=>[e(w,{class:"bar-card",shadow:"never"},{default:t(()=>[i("div",pe,[he,e(P,{modelValue:y.value,"onUpdate:modelValue":l[3]||(l[3]=a=>y.value=a),options:[{label:"7天",value:0},{label:"30天",value:1}]},null,8,["modelValue"])]),i("div",ge,[d.value.time.length?(c(),x(ie,{key:0,sent:y.value==0?d.value.sent.slice(-7):d.value.sent,recv:y.value==0?d.value.recv.slice(-7):d.value.recv,time:y.value==0?d.value.time.slice(-7):d.value.time,plugin:y.value==0?d.value.plugin.slice(-7):d.value.plugin},null,8,["sent","recv","time","plugin"])):(c(),x(U,{key:1,icon:"info",title:"未开启消息统计",class:"h-[350px] w-full"},{"sub-title":t(()=>[ye]),_:1}))])]),_:1})]),_:1})),[[ee],[N,r.value.countChart]]),(c(),_(b,null,k($,a=>V(e(D,{key:a.key,class:"mb-[18px]",xl:8,xs:24,md:24,sm:24,lg:12},{default:t(()=>[e(w,{shadow:"never"},{default:t(()=>[i("div",null,[i("div",xe,[e(X,{class:"box-item",effect:"light",content:a.desc,placement:"right-start"},{default:t(()=>[i("span",be,[m(h(a.name)+" ",1),e(Q,{class:"ml-2"},{default:t(()=>[e(T(ne))]),_:1})])]),_:2},1032,["content"])]),i("div",ke,[V(e(re,{data:g.value[a.key],name:a.name,style:se(u.value.style)},null,8,["data","name","style"]),[[oe,g.value[a.key].length]]),g.value[a.key]===!1?(c(),_("div",Se,[e(U,{icon:"info",title:`未开启${a.name}统计`},{"sub-title":t(()=>[i("p",null,"如果需要此统计, 请在stats.yaml中设置 "+h(a)+": true",1)]),_:2},1032,["title"])])):z("",!0),g.value[a.key].length===0?(c(),_("div",Ce,[e(U,{icon:"info",title:"没有当日数据"},{"sub-title":t(()=>[i("p",null,h(u.value.time),1)]),_:1})])):z("",!0)])])]),_:2},1024)]),_:2},1024),[[N,r.value.rankChart]])),64))]),_:1})])}}});export{Re as default};
