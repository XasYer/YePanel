import{d as L,a as he,m as _e,r as ge,g as Ce,s as xe}from"./system-BhlZrbHj.js";import{_ as ye}from"./svg.vue_vue_type_script_setup_true_lang-BA8ckxdk.js";import{d as be,r as d,u as S,i as C,M as l,v as s,j,A as h,x as U,aR as J,g as Y,q as ke,F as De,B as M,b7 as we,aY as $e,a_ as Re,C as r,w as Se,y as le,aI as f,b8 as je,n as Ie,aJ as Be,ae as Ee,af as Ue,h as Fe,_ as Ve}from"./index-CpafBiW4.js";import{_ as ze}from"./dialog.vue_vue_type_script_setup_true_lang-c6StVLt7.js";import"./index-glDPGLTR.js";const ae=A=>(Ee("data-v-86f6d68c"),A=A(),Ue(),A),Le={class:"mr-[10px] div-col"},Ae=ae(()=>j("div",null,"拖动文件到此处或点我上传",-1)),Te=ae(()=>j("div",{class:"text-center"},[r(" 仅支持简单文件上传，请勿上传大文件"),j("br"),r("上传同名文件将会覆盖原文件。 ")],-1)),Oe={class:"text-right"},Me={class:"flex items-center"},Pe={class:"mr-[10px]"},Ne={key:0},qe={key:0},We=be({name:"files",__name:"index",setup(A){const se=d(window.innerWidth<=768?62:window.innerWidth<=1200?66:70),m=d([]),g=d(""),I=d([]),P=d(),b=d([]),k=d(),T=d(!1),ne=t=>t.name!=="..",oe=t=>{b.value=t,b.value.length||(k.value=null)},ie=({prop:t,order:e})=>{let o=null;m.value[0].name===".."&&(o=m.value.shift());const n=[],u=[];m.value.forEach(c=>{c.isDir?n.push(c):u.push(c)});const a=c=>/^[^a-zA-Z\u4e00-\u9fa5]/.test(c),p=c=>/^[a-zA-Z]/.test(c),y=(c,v,w)=>{const R=a(c.name),_=a(v.name),B=p(c.name),E=p(v.name);if(w==="descending"){if(!R&&_)return-1;if(R&&!_)return 1;if(!B&&E)return-1;if(B&&!E)return 1}else{if(R&&!_)return-1;if(!R&&_)return 1;if(B&&!E)return-1;if(!B&&E)return 1}return c.name.localeCompare(v.name)*(w==="descending"?-1:1)},D=(c,v,w)=>{c.sort((R,_)=>w==="descending"?_[v]-R[v]:R[v]-_[v])};switch(t){case"name":n.sort((c,v)=>y(c,v,e)),u.sort((c,v)=>y(c,v,e));break;case"size":D(n,"rowSize",e),D(u,"rowSize",e);break;case"time":D(n,"mtimeMs",e),D(u,"mtimeMs",e);break}e==="descending"?m.value=[...u,...n]:m.value=[...n,...u],o&&m.value.unshift(o)},N=()=>{k.value=null,b.value=[],P.value.clearSelection()},ue=t=>new Promise((e,o)=>{const n=new FileReader;n.onloadend=()=>{e(n.result)},n.onerror=o,n.readAsText(t)}),G=d(),O=t=>{Be({title:t.title,width:"80%",top:"5vh",contentRenderer:()=>Fe(ze,{ref:G}),props:t.props,closeCallBack:t.closeCallBack})},K=t=>{if(t.isDir)I.value.length>=10&&I.value.pop(),I.value.unshift(g.value),$(t.path);else{const e=["jpg","jpeg","png","gif","ico","svg","webp","bmp"],o=["mp4","webm","flv","avi","wmv","mov"],n=["mp3","wav","wma","ogg","flac","aac","m4a"],u=["html","htm","css","less","sass","js","json","xml","vue","yaml","yml","md","cjs","mjs","ts","jsx","tsx","php","java","cpp","rs","erl","scm","go","lua","pas","pl","sql","styl","swift","tcl","toml","sh","gitignore","npmrc","erl","bat","bf","clj","coffee","ps1","txt","r","rb","py","ini","jl","vb","vbs"],a={type:null,data:{}};if(e.includes(t.ext))L(t.path,t.name).then(p=>{const y=URL.createObjectURL(p);a.type="image",a.data={url:y},O({props:a,title:t.name})});else if(u.includes(t.ext))L(t.path,t.name).then(p=>ue(p)).then(p=>{a.type="code",a.data={ext:t.ext,content:p},O({title:t.name,props:a,closeCallBack({options:y,args:D}){(D==null?void 0:D.command)==="sure"&&xe(t.path,G.value.getData().content).then(c=>{c.success?f("保存成功~ Ciallo～(∠・ω< )⌒☆",{customClass:"el",type:"success"}):f("保存失败:"+c.message,{customClass:"el",type:"error"})})}})});else if(o.includes(t.ext))L(t.path,t.name).then(p=>{const y=URL.createObjectURL(p);a.type="video",a.data={url:y},O({props:a,title:t.name})});else if(n.includes(t.ext))L(t.path,t.name).then(p=>{const y=URL.createObjectURL(p);a.type="audio",a.data={url:y},O({props:a,title:t.name})});else return f("暂不支持预览该文件类型",{customClass:"el",type:"warning"})}},Q=d(""),ce=t=>{let e=0,o=0;t.forEach(u=>{u.isDir?o++:e++});const n=["确认删除"];e&&n.push(`${e}个文件`),o&&(e&&n.push("和"),n.push(`${o}个文件夹`)),n.push("吗？"),Q.value=n.join("")},X=t=>{he(t.map(e=>({path:e.path,isDir:e.isDir}))).then(e=>{var o;if(N(),!e.success){f("操作失败:"+e.message,{customClass:"el",type:"error"});return}if((o=e.errors)!=null&&o.length)for(const{path:n,isDir:u,message:a}of e.errors)f((u?"文件夹":"文件")+`“${n}”删除失败:`+a,{customClass:"el",type:"error"});f("删除成功~ Ciallo～(∠・ω< )⌒☆",{customClass:"el",type:"success"}),$(g.value)})},re=t=>{L(t.path,t.name).then(e=>{je(e,t.name)}).catch(e=>{f("下载失败:"+e.message,{customClass:"el",type:"error"})})},q=d(!1),W=d(),Z=d([]),de=()=>{W.value.submit(),q.value=!0},me=t=>{const e=Z.value.indexOf(t.data.name);e!==-1&&Z.value.splice(e,1),t.success||f(t.data.name+"上传失败:"+t.message,{customClass:"el",type:"error"}),Z.value.length===0&&(W.value.clearFiles(),q.value=!1,T.value=!1,$(g.value),f("上传成功~ Ciallo～(∠・ω< )⌒☆",{customClass:"el",type:"success"}))},pe=t=>{var u;if((u=x.value)!=null&&u.path){H.value.focus();return}let e=m.value.findIndex(a=>(t==="file"?!a.isDir:a.isDir)&&a.name!=="..");e===-1&&(t==="dir"?e=1:e=m.value.length);let o="新建文件"+(t==="file"?".txt":"夹"),n=1;for(;m.value.some(a=>a.name===o);){o="新建文件"+(t==="file"?`（${n}）.txt`:`夹（${n}）`);n++}m.value.splice(e,0,{name:o,path:`${g.value}/${o}`,ext:t==="file"?"file":"folder",size:"",rowSize:0,time:"",mtimeMs:0,isDir:t==="dir"}),ee(m.value[e])},fe=()=>{_e(b.value.map(t=>({path:t.path,name:t.name,isDir:t.isDir})),g.value,k.value).then(t=>{var e;if(N(),!t.success){f("操作失败:"+t.message,{customClass:"el",type:"error"});return}if((e=t.errors)!=null&&e.length)for(const{path:o,isDir:n,message:u}of t.errors)f((n?"文件夹":"文件")+`“${o}” ${k.value}失败 ${u}`,{customClass:"el",type:"error"});f(`${k.value}}成功~ Ciallo～(∠・ω< )⌒☆`,{customClass:"el",type:"success"}),$(g.value)})},F=d(),x=d(),H=d(),ee=t=>{x.value=t,F.value=t.name,Ie(()=>{H.value.focus()})},ve=()=>{ge(x.value.path,F.value,x.value.isDir).then(t=>{const e=(x.value.mtimeMs===0?"创建":"重命名")+(x.value.isDir?"文件夹":"文件");if(te(),!t.success){f(`${e}成功失败...${t.message}`,{customClass:"el",type:"error"});return}f(`${e}成功~ Ciallo～(∠・ω< )⌒☆`,{customClass:"el",type:"success"}),$(g.value)})},te=()=>{x.value.mtimeMs===0&&m.value.splice(m.value.indexOf(x.value),1),x.value={},F.value=""},$=t=>{Ce(t).then(e=>{if(!e.success){f(e.message,{customClass:"el",type:"error"});return}g.value=e.data.path;const o=[];e.data.parentPath&&o.push({name:"..",path:e.data.parentPath,ext:"folder",size:"",time:"",isDir:!0});const n=[];e.data.files.forEach(u=>{u.isDir?o.push(u):n.push(u)}),m.value=[...o,...n],P.value.setScrollTop(0)})};return $(""),(t,e)=>{const o=h("el-dropdown-item"),n=h("el-dropdown-menu"),u=h("el-dropdown"),a=h("el-button"),p=h("el-input"),y=h("el-col"),D=h("el-popover"),c=h("el-popconfirm"),v=h("el-row"),w=h("el-table-column"),R=h("el-text"),_=h("el-link"),B=h("el-table"),E=h("el-card");return C(),S(E,{class:"h-[80vh]"},{default:l(()=>[s(v,{class:"flex flex-wrap"},{default:l(()=>[s(y,{xl:7,sm:12,lg:7,xs:24,class:"mr-[10px]"},{default:l(()=>[s(p,{modelValue:g.value,"onUpdate:modelValue":e[2]||(e[2]=i=>g.value=i)},{prepend:l(()=>[s(u,{"split-button":"",disabled:!I.value.length,style:{width:"40px"},onCommand:$,onClick:e[0]||(e[0]=i=>$(I.value.shift()))},{dropdown:l(()=>[s(n,null,{default:l(()=>[(C(!0),Y(De,null,ke(I.value,i=>(C(),S(o,{key:i,command:i},{default:l(()=>[r(le(i),1)]),_:2},1032,["command"]))),128))]),_:1})]),default:l(()=>[s(U(J),{icon:"mdi:arrow-left"})]),_:1},8,["disabled"])]),append:l(()=>[s(a,{onClick:e[1]||(e[1]=i=>$(g.value))},{default:l(()=>[s(U(J),{icon:"mdi:arrow-right"})]),_:1})]),_:1},8,["modelValue"])]),_:1}),j("div",Le,[s(D,{width:400,trigger:"click",visible:T.value},{reference:l(()=>[s(a,{type:"primary",class:"mr-[10px]",onClick:e[3]||(e[3]=i=>T.value=!0)},{default:l(()=>[r("上传")]),_:1})]),default:l(()=>[s(U(we),{ref_key:"uploadRef",ref:W,drag:"",action:`${U(Re)()}/upload-file`,multiple:"",data:{path:g.value},"show-file-list":"","auto-upload":!1,headers:{Authorization:`Bearer ${U($e)().accessToken}`},"on-success":me},{tip:l(()=>[Te,j("div",Oe,[s(a,{text:"",onClick:e[4]||(e[4]=i=>T.value=!1)},{default:l(()=>[r("取消")]),_:1}),s(a,{type:"primary",loading:q.value,onClick:de},{default:l(()=>[r(" 确认 ")]),_:1},8,["loading"])])]),default:l(()=>[j("div",null,[s(U(J),{icon:"mdi:upload",width:96,class:"m-auto"})]),Ae]),_:1},8,["action","data","headers"])]),_:1},8,["visible"]),s(u,{trigger:"click",onCommand:pe},{dropdown:l(()=>[s(n,null,{default:l(()=>[s(o,{command:"file"},{default:l(()=>[r(" 文件 ")]),_:1}),s(o,{command:"dir"},{default:l(()=>[r(" 文件夹 ")]),_:1})]),_:1})]),default:l(()=>[s(a,{type:"primary",class:"mr-[10px]"},{default:l(()=>[r("新建")]),_:1})]),_:1}),s(c,{title:Q.value,width:"300px",onConfirm:e[6]||(e[6]=i=>X(b.value))},{reference:l(()=>[s(a,{type:"danger",disabled:!b.value.length,onClick:e[5]||(e[5]=i=>ce(b.value))},{default:l(()=>[r("删除")]),_:1},8,["disabled"])]),_:1},8,["title"]),s(a,{type:"primary",disabled:!b.value.length||k.value=="copy",onClick:e[7]||(e[7]=i=>k.value="copy")},{default:l(()=>[r("复制")]),_:1},8,["disabled"]),s(a,{type:"primary",disabled:!b.value.length||k.value=="move",onClick:e[8]||(e[8]=i=>k.value="move")},{default:l(()=>[r("移动")]),_:1},8,["disabled"]),b.value.length?(C(),S(a,{key:0,type:"default",onClick:N},{default:l(()=>[r("取消")]),_:1})):M("",!0),k.value?(C(),S(a,{key:1,type:"success",onClick:fe},{default:l(()=>[r("粘贴")]),_:1})):M("",!0)])]),_:1}),j("div",null,[s(B,{ref_key:"tableRef",ref:P,data:m.value,"row-key":"path",height:`${se.value}vh`,onCellDblclick:K,onSelectionChange:oe,onSortChange:ie},{default:l(()=>[s(w,{type:"selection",selectable:ne,"reserve-selection":""}),r('" '),s(w,{label:"名称",sortable:"'custom'",prop:"name"},{default:l(i=>{var V;return[j("div",Me,[j("div",Pe,[(C(),S(Se(ye),{name:i.row.ext},null,8,["name"]))]),((V=x.value)==null?void 0:V.path)===i.row.path?(C(),S(p,{key:0,ref_key:"renameInputRef",ref:H,modelValue:F.value,"onUpdate:modelValue":e[9]||(e[9]=z=>F.value=z)},{append:l(()=>[s(a,{onClick:ve},{default:l(()=>[r("确认")]),_:1})]),_:1},8,["modelValue"])):(C(),S(R,{key:1},{default:l(()=>[r(le(i.row.name),1)]),_:2},1024))])]}),_:1}),s(w,{label:"大小",prop:"size",sortable:"'custom'"}),s(w,{label:"修改时间",prop:"time",sortable:"'custom'"}),s(w,{label:"操作"},{default:l(i=>{var V;return[((V=x.value)==null?void 0:V.path)!==i.row.path?(C(),Y("span",Ne,[s(_,{underline:!1,onClick:z=>K(i.row)},{default:l(()=>[r("打开")]),_:2},1032,["onClick"]),i.row.name!==".."?(C(),Y("span",qe,[s(_,{underline:!1,onClick:z=>ee(i.row)},{default:l(()=>[r("重命名")]),_:2},1032,["onClick"]),i.row.isDir?M("",!0):(C(),S(_,{key:0,underline:!1,onClick:z=>re(i.row)},{default:l(()=>[r("下载")]),_:2},1032,["onClick"])),s(c,{title:i.row.isDir?"确认删除这个文件夹吗？":"确认删除这个文件吗？",width:"200px",onConfirm:z=>X([i.row])},{reference:l(()=>[s(_,{underline:!1,type:"danger"},{default:l(()=>[r("删除")]),_:1})]),_:2},1032,["title","onConfirm"])])):M("",!0)])):(C(),S(_,{key:1,onClick:te},{default:l(()=>[r("取消")]),_:1}))]}),_:1})]),_:1},8,["data","height"])])]),_:1})}}}),Ke=Ve(We,[["__scopeId","data-v-86f6d68c"]]);export{Ke as default};
