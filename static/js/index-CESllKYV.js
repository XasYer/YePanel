import{d as U,r as n,o as D,ao as I,u as b,i as d,M as i,j as _,v as p,C as g,A as m,g as J,q as W,x as L,F as q,aF as G}from"./index-CpafBiW4.js";import{_ as H,T as K}from"./vue-web-terminal-uwcx1Pu6.js";import{C as P}from"./ansi_to_html-DlaCULag.js";const z={class:"flex flex-wrap"},Q={class:"mb-[10px]"},X={class:"mb-[10px]"},Y={class:"mb-[10px]"},Z={class:"h-[70vh]"},ne=U({name:"realtimeLog",__name:"index",setup(ee){const N=new P,k={tarce:"#999999",debug:"#00aaff",info:"#00cc00",mark:"#999999",warn:"#ffaa00",error:"#ff0000",fatal:"#990000"},R={trace:"TRCE",debug:"DBUG",info:"INFO",warn:"WARN",error:"ERRR",fatal:"FATL",mark:"MARK"},O=Object.keys(k).reduce((e,a)=>(e[a]=Object.keys(k).indexOf(a),e),{}),C=n(2),h=n(10),j=e=>h.value=e,l=n(),S=n(""),V=n(!1),r=n(null),f=n(),F=()=>{l.value.clearLog()},y=n(!1),w=n([]),T=()=>{y.value=!0},B=()=>{for(y.value=!1;w.value.length;)l.value.pushMessage(w.value.shift())},$=e=>{if(Array.isArray(e))return"[ "+e.map($).join(" ")+" ]";if(typeof e=="object")try{return`{${Object.entries(e).map(([a,c])=>{const v=typeof c=="string"?`'${c}'`:c;return` ${a}: ${v} `}).join(", ")}}`}catch{return String(e)}return e},M=n(null),E=(e,a,c,v,A)=>{if(a==="Ciallo～(∠・ω< )⌒☆"&&!V.value)l.value.pushMessage({type:"normal",content:"Authentication in progress..."}),r.value=G("realtimeLog",{onmessage:u=>{try{const t=JSON.parse(u.data);if(t.type==="logger"&&C.value<=O[t.level]){const s={type:"html",content:`<span style="color:${k[t.level]}">[${t.timestamp}][${R[t.level]}]</span>${t.logs.map(o=>typeof o=="string"?(o=N.toHtml(o).replace(/#00A/g,"#4169e1"),o):$(o)).join(" ").replace(/\n|\r/g,"<br>").replace(new RegExp("(?<=^|>)([^<]*?)(?=<|$)","g"),o=>o.replace(/ /g,"&nbsp;"))}`};y.value?w.value.push(s):l.value.pushMessage(s)}}catch(t){l.value.pushMessage({type:"table",content:t,class:"error",tag:"error"}),f.value.finish();return}},onopen:()=>{V.value=!0,l.value.pushMessage({type:"normal",content:"Authentication successful.",class:"success"}),M.value=setInterval(()=>{r.value.send(JSON.stringify({time:Math.floor(Date.now()/1e3),action:"ping"}))},3e4)},onerror:u=>{l.value.pushMessage({type:"table",content:u,class:"error",tag:"error"}),f.value.finish(),r.value=null},onclose:u=>{l.value.pushMessage({type:"normal",content:"终端已关闭！",class:"error",tag:"error"}),f.value.finish(),r.value=null,clearInterval(M.value),M.value=null}});else{const t=a.split(" ").slice(1),x={action:"execute",command:e,args:t,workingDirectory:S.value};r.value.readyState===1?(r.value.send(JSON.stringify(x)),f.value=new K,c(f.value)):v("终端连接异常！")}};return D(()=>{l.value.execute("Ciallo～(∠・ω< )⌒☆")}),I(()=>{r.value&&r.value.close()}),(e,a)=>{const c=m("el-text"),v=m("el-input-number"),A=m("el-option"),u=m("el-select"),t=m("el-button"),x=m("el-card");return d(),b(x,null,{default:i(()=>[_("div",z,[_("div",Q,[p(c,null,{default:i(()=>[g("行高: ")]),_:1}),p(v,{modelValue:h.value,"onUpdate:modelValue":a[0]||(a[0]=s=>h.value=s),class:"mx-[10px]",min:1,max:100,onChange:j},null,8,["modelValue"])]),_("div",X,[p(c,{class:"w-[70px]"},{default:i(()=>[g(" 日志等级: ")]),_:1}),p(u,{modelValue:C.value,"onUpdate:modelValue":a[1]||(a[1]=s=>C.value=s),style:{width:"150px"},class:"mr-[10px]"},{default:i(()=>[(d(!0),J(q,null,W(Object.keys(L(O)),(s,o)=>(d(),b(A,{key:s,label:s,value:o},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_("div",Y,[p(t,{type:"danger",onClick:F},{default:i(()=>[g(" 清空 ")]),_:1}),y.value?(d(),b(t,{key:1,type:"success",onClick:B},{default:i(()=>[g(" 继续 ")]),_:1})):(d(),b(t,{key:0,type:"primary",onClick:T},{default:i(()=>[g(" 暂停 ")]),_:1}))])]),_("div",Z,[p(L(H),{ref_key:"terminalRef",ref:l,name:"terminal",context:S.value,"enable-fold":!1,"line-space":h.value,"show-header":!1,"enable-default-command":!1,onExecCmd:E},null,8,["context","line-space"])])]),_:1})}}});export{ne as default};
